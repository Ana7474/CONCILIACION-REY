' 7) DEBUG: evaluar fecha en E SIN borrar (colorear y contar)
Dim todayDate As Date
Dim keep As Boolean
Dim parts() As String
Dim dd As Long, mm As Long, yy As Long
Dim s As String
Dim p As Long
Dim d As Variant
Dim keptCnt As Long, badDateCnt As Long, notTodayCnt As Long

todayDate = Date
lastRow = wsDATA.Cells(wsDATA.Rows.Count, "E").End(xlUp).Row

keptCnt = 0: badDateCnt = 0: notTodayCnt = 0

If lastRow >= 2 Then
    ' limpia colores anteriores
    wsDATA.Range("A2:Z" & lastRow).Interior.ColorIndex = xlNone
End If

For i = 2 To lastRow
    keep = False
    d = Empty

    If IsDate(wsDATA.Cells(i, "E").Value) Then
        If DateValue(wsDATA.Cells(i, "E").Value) = todayDate Then keep = True
    Else
        s = CStr(wsDATA.Cells(i, "E").Value)
        s = Replace$(s, Chr$(160), " ")          ' NBSP -> espacio normal
        s = Replace$(s, ChrW$(&H202F), " ")      ' NBSP delgado
        s = Trim$(s)
        p = InStr(s, " ")
        If p > 0 Then s = Left$(s, p - 1)
        s = Replace$(s, ".", "/")
        s = Replace$(s, "-", "/")
        s = WorksheetFunction.Trim(s)

        parts = Split(s, "/")
        If UBound(parts) = 2 Then
            On Error Resume Next
            If Len(parts(0)) = 4 Then
                ' yyyy/mm/dd
                yy = CLng(parts(0)): mm = CLng(parts(1)): dd = CLng(parts(2))
            Else
                ' dd/mm/yyyy
                dd = CLng(parts(0)): mm = CLng(parts(1)): yy = CLng(parts(2))
            End If
            d = DateSerial(yy, mm, dd)
            On Error GoTo 0
            If IsDate(d) Then
                If DateValue(d) = todayDate Then keep = True
            End If
        End If
    End If

    If keep Then
        keptCnt = keptCnt + 1
        wsDATA.Rows(i).Interior.Color = RGB(198, 239, 206)      ' verde (HOY)
    Else
        If IsEmpty(d) And Not IsDate(wsDATA.Cells(i, "E").Value) Then
            badDateCnt = badDateCnt + 1
            wsDATA.Rows(i).Interior.Color = RGB(255, 199, 206)  ' rojo (no se pudo parsear)
        Else
            notTodayCnt = notTodayCnt + 1
            wsDATA.Rows(i).Interior.Color = RGB(255, 235, 156)  ' amarillo (fecha válida, no hoy)
        End If
    End If
Next i

MsgBox "DEBUG fechas en E:" & vbCrLf & _
       "Mantendría (HOY): " & keptCnt & vbCrLf & _
       "Válidas pero NO hoy: " & notTodayCnt & vbCrLf & _
       "No se pudo interpretar: " & badDateCnt, vbInformation