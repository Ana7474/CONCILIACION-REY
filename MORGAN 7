Sub Small_ImportExcel_To_DATA_And_CONCILIACION()
    Dim fd As FileDialog
    Dim filePath As String
    Dim wbSrc As Workbook
    Dim wsSrc As Worksheet
    Dim wsDATA As Worksheet, wsCONC As Worksheet
    Dim found As Range
    Dim lastRowSrc As Long, lastColSrc As Long
    Dim lastRowData As Long, lastRowConc As Long
    Dim gotData As Boolean
    Dim i As Long
    Dim todayDate As Date

    On Error Resume Next
    Set wsDATA = ThisWorkbook.Sheets("DATA")
    Set wsCONC = ThisWorkbook.Sheets("CONCILIACIÓN")
    If wsCONC Is Nothing Then Set wsCONC = ThisWorkbook.Sheets("CONCILIACION")
    On Error GoTo 0

    If wsDATA Is Nothing Or wsCONC Is Nothing Then
        MsgBox "Required sheets not found (DATA / CONCILIACIÓN).", vbCritical
        Exit Sub
    End If

    Application.ScreenUpdating = False
    Application.EnableEvents = False

    todayDate = Date

    ' 1) Clean DATA and CONCILIACIÓN
    wsDATA.Cells.Clear
    wsCONC.Cells.Clear

    ' 2) Ask for an Excel file
    Set fd = Application.FileDialog(msoFileDialogFilePicker)
    With fd
        .Title = "Select an Excel file"
        .Filters.Clear
        .Filters.Add "Excel Files", "*.xlsx;*.xlsm;*.xls;*.xlsb"
        .AllowMultiSelect = False
        If .Show <> -1 Then GoTo TidyExit
        filePath = .SelectedItems(1)
    End With

    ' 3) Open source workbook
    Set wbSrc = Workbooks.Open(Filename:=filePath)
    If wbSrc Is Nothing Then
        MsgBox "Couldn't open the selected Excel file.", vbCritical
        GoTo TidyExit
    End If

    ' 4) Copy FIRST sheet's real used range -> DATA!A1
    Set wsSrc = wbSrc.Worksheets(1)

    gotData = False
    Set found = wsSrc.Cells.Find(What:="*", LookIn:=xlFormulas, LookAt:=xlPart, _
                                 SearchOrder:=xlByRows, SearchDirection:=xlPrevious, MatchCase:=False)
    If Not found Is Nothing Then
        lastRowSrc = found.Row
        Set found = wsSrc.Cells.Find(What:="*", LookIn:=xlFormulas, LookAt:=xlPart, _
                                     SearchOrder:=xlByColumns, SearchDirection:=xlPrevious, MatchCase:=False)
        lastColSrc = found.Column

        wsSrc.Range(wsSrc.Cells(1, 1), wsSrc.Cells(lastRowSrc, lastColSrc)).Copy wsDATA.Range("A1")
        gotData = True
    End If

    wbSrc.Close SaveChanges:=False

    If Not gotData Then
        MsgBox "The first sheet appears to be empty (no data found).", vbExclamation
        GoTo TidyExit
    End If

    ' 5) Copy columns A:H from DATA to CONCILIACIÓN (last row by column C)
    lastRowData = wsDATA.Cells(wsDATA.Rows.Count, "C").End(xlUp).Row
    If lastRowData >= 1 Then
        wsDATA.Range("A1:H" & lastRowData).Copy wsCONC.Range("A1")
    End If

    ' 6) Delete rows in CONCILIACIÓN where column B is empty (after headers)
    lastRowConc = wsCONC.Cells(wsCONC.Rows.Count, "C").End(xlUp).Row
    For i = lastRowConc To 2 Step -1
        If Trim(wsCONC.Cells(i, "B").Value) = "" Then
            wsCONC.Rows(i).Delete
        End If
    Next i

    ' 7) If A is empty, set A = UCase(C) & "MXN" (after headers)
    lastRowConc = wsCONC.Cells(wsCONC.Rows.Count, "C").End(xlUp).Row
    For i = 2 To lastRowConc
        If Trim(CStr(wsCONC.Cells(i, "A").Value)) = "" Then
            wsCONC.Cells(i, "A").Value = UCase$(Trim$(CStr(wsCONC.Cells(i, "C").Value))) & "MXN"
        End If
    Next i

    ' 8) Make D and E absolute values
    For i = 2 To lastRowConc
        If IsNumeric(wsCONC.Cells(i, "D").Value) Then
            wsCONC.Cells(i, "D").Value = Abs(wsCONC.Cells(i, "D").Value)
        End If
        If IsNumeric(wsCONC.Cells(i, "E").Value) Then
            wsCONC.Cells(i, "E").Value = Abs(wsCONC.Cells(i, "E").Value)
        End If
    Next i

    ' 9) Keep only today's date in column G
    lastRowConc = wsCONC.Cells(wsCONC.Rows.Count, "C").End(xlUp).Row
    For i = lastRowConc To 2 Step -1
        If IsDate(wsCONC.Cells(i, "G").Value) Then
            If DateValue(wsCONC.Cells(i, "G").Value) <> todayDate Then
                wsCONC.Rows(i).Delete
            End If
        Else
            wsCONC.Rows(i).Delete
        End If
    Next i

    MsgBox "Imported, copied A:H, cleaned empty B, filled A, made D/E absolute, and kept only today's rows in G.", vbInformation

TidyExit:
    Application.CutCopyMode = False
    Application.EnableEvents = True
    Application.ScreenUpdating = True
End Sub