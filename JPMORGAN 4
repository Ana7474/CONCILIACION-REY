Sub Start_ImportExcel_to_DATA()
    Dim fd As FileDialog
    Dim filePath As String
    Dim wbSrc As Workbook
    Dim wsSrc As Worksheet, wsDATA As Worksheet, wsCONC As Worksheet
    Dim lastRow As Long, lastCol As Long
    Dim rngSrc As Range
    Dim i As Long, s As String, p As Long
    Dim found As Range, gotData As Boolean

    On Error Resume Next
    Set wsDATA = ThisWorkbook.Sheets("DATA")
    Set wsCONC = ThisWorkbook.Sheets("CONCILIACIÓN")
    On Error GoTo 0
    If wsDATA Is Nothing Or wsCONC Is Nothing Then
        MsgBox "Required sheets not found (DATA / CONCILIACIÓN).", vbCritical
        Exit Sub
    End If

    Application.ScreenUpdating = False
    Application.EnableEvents = False

    ' 1) Clean both sheets
    wsDATA.Cells.Clear
    wsCONC.Cells.Clear

    ' 2) Ask for an Excel file
    Set fd = Application.FileDialog(msoFileDialogFilePicker)
    With fd
        .Title = "Select an Excel file"
        .Filters.Clear
        .Filters.Add "Excel Files", "*.xlsx;*.xlsm;*.xls;*.xlsb"
        .AllowMultiSelect = False
        If .Show <> -1 Then GoTo TidyExit
        filePath = .SelectedItems(1)
    End With

    ' 3) Open source workbook
    On Error Resume Next
    Set wbSrc = Workbooks.Open(Filename:=filePath)
    On Error GoTo 0
    If wbSrc Is Nothing Then
        MsgBox "Couldn't open the Excel file. If it opened in Protected View, click 'Enable Editing' and try again.", vbCritical
        GoTo TidyExit
    End If

    ' 4) Find a sheet with real data and copy A1:lastCell to DATA!A1
    gotData = False
    For Each wsSrc In wbSrc.Worksheets
        Set found = wsSrc.Cells.Find(What:="*", LookIn:=xlFormulas, LookAt:=xlPart, _
                                     SearchOrder:=xlByRows, SearchDirection:=xlPrevious, MatchCase:=False)
        If Not found Is Nothing Then
            lastRow = found.Row
            Set found = wsSrc.Cells.Find(What:="*", LookIn:=xlFormulas, LookAt:=xlPart, _
                                         SearchOrder:=xlByColumns, SearchDirection:=xlPrevious, MatchCase:=False)
            lastCol = found.Column

            Set rngSrc = wsSrc.Range(wsSrc.Cells(1, 1), wsSrc.Cells(lastRow, lastCol))
            rngSrc.Copy wsDATA.Range("A1")
            gotData = True
            Exit For
        End If
    Next wsSrc

    wbSrc.Close SaveChanges:=False

    If Not gotData Then
        MsgBox "No data found in the selected workbook (all sheets appear empty).", vbExclamation
        GoTo TidyExit
    End If

    ' 5) Clean column B in DATA: keep only first word, uppercase
    lastRow = wsDATA.Cells(wsDATA.Rows.Count, "B").End(xlUp).Row
    For i = 2 To lastRow
        s = Trim(CStr(wsDATA.Cells(i, "B").Value))
        If Len(s) > 0 Then
            p = InStr(s, " ")
            If p > 0 Then s = Left$(s, p - 1)
            wsDATA.Cells(i, "B").Value = UCase$(s)
        End If
    Next i

    MsgBox "Imported " & lastRow - 1 & " rows into 'DATA' and cleaned column B.", vbInformation

TidyExit:
    Application.CutCopyMode = False
    Application.EnableEvents = True
    Application.ScreenUpdating = True
End Sub