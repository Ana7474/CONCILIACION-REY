Sub Start_ImportXML_to_DATA()
    Dim fd As FileDialog
    Dim filePath As String
    Dim wbXML As Workbook, wsXML As Worksheet
    Dim wsDATA As Worksheet, wsCONC As Worksheet
    Dim lastRow As Long, lastCol As Long
    Dim i As Long, s As String, p As Long

    On Error Resume Next
    Set wsDATA = ThisWorkbook.Sheets("DATA")
    Set wsCONC = ThisWorkbook.Sheets("CONCILIACIÓN")
    On Error GoTo 0
    If wsDATA Is Nothing Or wsCONC Is Nothing Then
        MsgBox "Required sheets not found (DATA / CONCILIACIÓN).", vbCritical
        Exit Sub
    End If

    Application.ScreenUpdating = False
    Application.EnableEvents = False

    ' 1) Clean both sheets
    wsDATA.Cells.Clear
    wsCONC.Cells.Clear

    ' 2) Ask for XML
    Set fd = Application.FileDialog(msoFileDialogFilePicker)
    With fd
        .Title = "Select an XML file"
        .Filters.Clear
        .Filters.Add "XML Files", "*.xml"
        .AllowMultiSelect = False
        If .Show <> -1 Then GoTo TidyExit
        filePath = .SelectedItems(1)
    End With

    ' 3) Open XML and paste into DATA
    On Error Resume Next
    Set wbXML = Workbooks.Open(Filename:=filePath)
    On Error GoTo 0
    If wbXML Is Nothing Then
        MsgBox "Couldn't open the XML file in Excel format.", vbCritical
        GoTo TidyExit
    End If

    Set wsXML = wbXML.Sheets(1)

    ' Use UsedRange to be safe with XML imports
    With wsXML.UsedRange
        lastRow = .Rows(.Rows.Count).Row
        lastCol = .Columns(.Columns.Count).Column
        .Copy wsDATA.Range("A1")
    End With

    wbXML.Close SaveChanges:=False

    ' 4) Clean up column B in DATA: keep only text before the first space, uppercase
    lastRow = wsDATA.Cells(wsDATA.Rows.Count, "B").End(xlUp).Row
    For i = 2 To lastRow
        s = Trim(CStr(wsDATA.Cells(i, "B").Value))
        If Len(s) > 0 Then
            p = InStr(s, " ")
            If p > 0 Then s = Left$(s, p - 1)
            wsDATA.Cells(i, "B").Value = UCase$(s)
        End If
    Next i

    MsgBox "XML imported into 'DATA' and column B cleaned (only first word in caps).", vbInformation

TidyExit:
    Application.CutCopyMode = False
    Application.EnableEvents = True
    Application.ScreenUpdating = True
End Sub