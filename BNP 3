Sub CleanImportAndCopy_AtoH()
    Dim fd As FileDialog
    Dim filePath As String
    Dim wbCSV As Workbook, wsCSV As Worksheet
    Dim wsDATA As Worksheet, wsCONC As Worksheet
    Dim lastRowDATA As Long, lastRowCONC As Long
    Dim i As Long, s As String, p As Long

    On Error Resume Next
    Set wsDATA = ThisWorkbook.Sheets("DATA")
    Set wsCONC = ThisWorkbook.Sheets("CONCILIACIÓN")
    On Error GoTo 0
    If wsDATA Is Nothing Or wsCONC Is Nothing Then
        MsgBox "Required sheets not found (DATA / CONCILIACIÓN).", vbCritical
        Exit Sub
    End If

    Application.ScreenUpdating = False
    Application.EnableEvents = False

    ' 1) Limpiar ambas hojas
    wsDATA.Cells.Clear
    wsCONC.Cells.Clear

    ' 2) Pedir CSV
    Set fd = Application.FileDialog(msoFileDialogFilePicker)
    With fd
        .Title = "Select a CSV file"
        .Filters.Clear
        .Filters.Add "CSV Files", "*.csv"
        .AllowMultiSelect = False
        If .Show <> -1 Then GoTo TidyExit
        filePath = .SelectedItems(1)
    End With

    ' 3) Abrir CSV y pegar en DATA
    Set wbCSV = Workbooks.Open(filePath)
    Set wsCSV = wbCSV.Sheets(1)

    With wsCSV
        lastRowDATA = .Cells(.Rows.Count, "A").End(xlUp).Row
        .Range(.Cells(1, 1), .Cells(lastRowDATA, "H")).Copy wsDATA.Range("A1")
    End With

    wbCSV.Close SaveChanges:=False

    ' 4) Copiar A:H de DATA -> A:H en CONCILIACIÓN (tal cual)
    wsDATA.Range("A1", wsDATA.Cells(lastRowDATA, "H")).Copy
    wsCONC.Range("A1").PasteSpecial xlPasteAll
    Application.CutCopyMode = False

    ' === 5) Normalizar fechas en G (quitar hora) y H, y poner formato EN-US DD-MMM-YYYY ===
    lastRowCONC = wsCONC.Cells(wsCONC.Rows.Count, "A").End(xlUp).Row
    If lastRowCONC < 2 Then GoTo TidyExit

    For i = 2 To lastRowCONC
        ' ----- Columna G: quitar hora si viene "25-Aug-2025 11:33:23" -----
        s = Trim(CStr(wsCONC.Cells(i, "G").Value))
        If Len(s) > 0 Then
            ' Si trae espacio, recorta antes del espacio (fecha sola)
            p = InStr(1, s, " ")
            If p > 0 Then s = Left$(s, p - 1)

            ' Convertir separadores comunes a "/" y forzar a fecha
            s = Replace(Replace(s, ".", "/"), "-", "/")
            On Error Resume Next
            wsCONC.Cells(i, "G").Value = CDate(s)
            On Error GoTo 0
        End If

        ' ----- Columna H: convertir a fecha (ya viene sin hora) -----
        s = Trim(CStr(wsCONC.Cells(i, "H").Value))
        If Len(s) > 0 Then
            s = Replace(Replace(s, ".", "/"), "-", "/")
            On Error Resume Next
            wsCONC.Cells(i, "H").Value = CDate(s)
            On Error GoTo 0
        End If
    Next i

    ' Formato con meses en inglés (independiente del idioma de Excel)
    wsCONC.Range("G2:G" & lastRowCONC).NumberFormat = "[$-en-US]dd-mmm-yyyy"
    wsCONC.Range("H2:H" & lastRowCONC).NumberFormat = "[$-en-US]dd-mmm-yyyy"

    MsgBox "CSV importado, A:H copiado y fechas normalizadas (G sin hora, G/H en DD-MMM-YYYY).", vbInformation

TidyExit:
    Application.EnableEvents = True
    Application.ScreenUpdating = True
End Sub